<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GuidaWePacsLinux2025</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Importa il nuovo font - Esempio con Roboto Mono -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Roboto Mono', monospace; /* Nuovo font per tutto il corpo */
            background: linear-gradient(45deg, #0f0c29, #302b63, #24243e);
            padding: 40px;
            display: flex;
            justify-content: center;
            color: #e0e0e0;
            scroll-behavior: smooth;
        }
        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 20px;
            box-shadow: 0 12px 30px rgba(0,0,0,0.6);
            padding: 40px;
            position: relative;
            border: 1px solid rgba(76, 175, 80, 0.5);
            backdrop-filter: blur(5px);
        }
        .logo {
            text-align: center;
            font-size: 60px;
            margin-bottom: 20px;
            animation: pulse 2s infinite ease-in-out;
        }
        @keyframes pulse {
            0% { transform: scale(1); filter: drop-shadow(0 0 5px rgba(76, 175, 80, 0.5)); }
            50% { transform: scale(1.1); filter: drop-shadow(0 0 15px rgba(76, 175, 80, 0.8)); }
            100% { transform: scale(1); filter: drop-shadow(0 0 5px rgba(76, 175, 80, 0.5)); }
        }
        h1, h3 {
            text-align: center;
            margin-bottom: 30px;
            color: #4caf50;
            text-shadow: 0 0 8px rgba(76, 175, 80, 0.6);
        }
        .progress-container {
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 30px;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            width: 0;
            transition: width 0.6s ease-in-out;
        }
        .accordion {
            background-color: rgba(0, 0, 0, 0.3);
            color: #e0e0e0;
            border-radius: 15px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.5);
            margin-bottom: 20px;
            cursor: pointer;
            transition: background-color 0.4s ease, box-shadow 0.4s ease;
            overflow: hidden;
            border: 1px solid rgba(76, 175, 80, 0.2);
        }
        .accordion-header {
            padding: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            font-size: 1.1em;
            color: #8bc34a;
            transition: color 0.3s ease;
        }
        .accordion:hover {
            background-color: rgba(0, 0, 0, 0.5);
            box-shadow: 0 8px 20px rgba(0,0,0,0.7);
        }
        .accordion.active {
            background-color: rgba(76, 175, 80, 0.2);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4);
        }
        .accordion.active .accordion-header {
             color: #4caf50;
             text-shadow: 0 0 5px rgba(76, 175, 80, 0.8);
        }
        .accordion i {
            transition: transform 0.4s ease;
            color: #4caf50;
        }
        .accordion.active i {
            transform: rotate(90deg);
             color: #8bc34a;
        }
        .panel {
            padding: 0 25px 20px 25px;
            background-color: rgba(0, 0, 0, 0.4);
            color: #e0e0e0;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.7s ease-in-out;
        }
         .panel p {
            margin: 15px 0 0 0;
            line-height: 1.7;
         }
         .panel strong {
             color: #8bc34a;
         }
        .panel img {
            max-width: 100%;
            border-radius: 10px;
            margin-top: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        }

        /* Stile per evidenziare i comandi */
        .command-highlight {
            display: block;
            background-color: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.4);
            border-radius: 8px;
            padding: 10px 15px;
            margin: 15px 0;
            color: #a5d6a7;
            /* Rimosso font-family specifico per i comandi per usare il font generale */
            word-break: break-all;
            white-space: pre-wrap;
        }

        .animated-arrow {
            margin-right: 10px;
            color: #4caf50;
            animation: bounce 1s infinite ease-in-out;
        }
        @keyframes bounce {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(8px); }
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .nav-buttons button {
            background: linear-gradient(45deg, #4caf50, #8bc34a);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.4s ease, transform 0.2s ease;
            font-weight: bold;
            text-transform: uppercase;
        }
        .nav-buttons button:hover {
            background: linear-gradient(45deg, #388e3c, #689f38);
            transform: translateY(-2px);
        }
        .nav-buttons button:active {
             transform: translateY(0);
        }
        .nav-buttons button:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.6;
            transform: none;
        }
        .step-counter {
            text-align: center;
            margin-bottom: 20px;
            font-weight: bold;
            color: #8bc34a;
            font-size: 1.2em;
            text-shadow: 0 0 5px rgba(139, 195, 74, 0.5);
        }

    </style>
</head>
<body>

<div class="container">
    <div class="logo">
        <!-- Assicurati che il percorso dell'immagine sia corretto -->
        <img src="wepacs-logo-1.svg" alt="Logo" style="width:180px; height:auto;">
    </div>

    <h1>Installazione Linux 2025<br><br>  Orthanc + wepacs + MongoDB </h1>
    <div class="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
    </div>
    <div class="step-counter" id="step-counter">Passo 1 di 5</div>

    <div class="accordion">
        <div class="accordion-header">1️⃣ Creazione database per Orthanc DICOM Server<i class="fas fa-chevron-right"></i></div>
        <div class="panel">
            <p>Prima di iniziare regolare data ora del server con comando<br><br>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>sudo dpkg-reconfigure tzdata</span>
                <br><br> -------------------------------------------------<br><br>

                Creare anche il database per Orthanc DICOM Server seguendo la stessa procedura. <br><br>Quello che cambia è
                l’utente che in questo caso è “orthanc”:
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>sudo -u postgres createuser --interactive --password orthanc</span>
                rispondere y alla richiesta Shall the new role be a superuser? (y/n), quindi digitare la
                password.
                Infine creare il database con il comando seguente:<br><br>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>sudo -u postgres createdb orthanc -O orthanc</span>
                Impostazione di sicurezza
                Modificare le impostazioni di sicurezza di PostgreSQL modificando le seguenti righe del file<br><br>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>/etc/postgresql/[VERSIONE POSTGRESQL]/main/pg_hba.conf:</span>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>local all all trust</span>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>host all all 127.0.0.1/32 trust</span>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>host all all ::1/128 trust</span>

                Riavviare il servizio di PostgreSQL come descritto in Riavviare i servizi e determinarne lo stato:
                Per verificare che il database sia stato creato ed accessibile, digitare il seguente comando:<br><br>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>psql -U wepacs -d wepacs -W</span>

                dovrebbe apparire:<br><br>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>psql (14.5 (Ubuntu 14.5-0ubuntu0.22.04.1))
                Type "help" for help.</span>
                <span class="command-highlight">wepacs=#</span>
                </p>
            <div class="nav-buttons">
                <button disabled>Indietro</button>
                <button onclick="goToStep(1)">Avanti</button>
            </div>
        </div>
    </div>

    <div class="accordion">
        <div class="accordion-header">2️⃣ Installazione di PostgreSQL<i class="fas fa-chevron-right"></i></div>
        <div class="panel">
            <p>Per verificare se il motore di database PostgreSQL è stato installato correttamente digitare il seguente
                comando:<br><br>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>sudo -u postgres psql postgres</span>
                se viene restituito che il comando non è stato trovato, installare PostgreSQL eseguendo il seguente
                comando:<br><br>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>sudo apt update</span>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>sudo apt-get install postgresql</span>
                Alla fine rieseguire il primo comando, ossia:<br><br>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>sudo -u postgres psql postgres</span>
                viene visualizzato un messaggio simile al seguente (la versione di PostgreSQL utilizzata per in questo
                documento è la 14.5):<br><br>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>psql (14.5 (Ubuntu 14.5-0ubuntu0.22.04.1)) Type "help" for help. postgres=#</span>
                digitare il seguente comando:

               <br><br>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>\password postgres</span>
                viene quindi richiesto di impostare la password. Una volta ridigitata la password digitare exit e premere
                Invio.<br><br>
                <strong><i class="fas fa-arrow-right animated-arrow"></i>IMPORTANTE</strong><br><br>

                <strong>Prendere nota della password impostata perché va riportata nel parametro
                “spring.datasource.password” del file “application.properties” di WePacs</strong></p>
                <div class="nav-buttons">
                    <button onclick="goToStep(0)">Indietro</button>
                    <button onclick="goToStep(2)">Avanti</button>
                </div>
        </div>
    </div>


    <div class="accordion">
        <div class="accordion-header">3️⃣ Installazione di Orthanc DICOM Server<i class="fas fa-chevron-right"></i></div>
        <div class="panel">
            <p>L’installazione di Orthanc DICOM Server è molto semplice e consiste nell’esecuzione, in sequenza, dei
                seguenti comandi (rispondere Y se richiesto);<br><br>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>sudo apt install orthanc</span>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>sudo apt install orthanc-dicomweb</span>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>sudo apt install orthanc-imagej</span>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>sudo apt install orthanc-postgresql</span>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>sudo apt install orthanc-python</span>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>sudo apt install orthanc-webviewer</span>

                Dopo l’installazione configurare Orthanc DICOM Server. Il file di configurazione <strong> “orthanc.json” è presente
                nella directory /etc/orthanc</strong> <br><br>

                IMPORTANTE<br><br>

                Nei sistemi operativi Linux le porte inferiori a 1024 non possono essere utilizzate, se non
                mediante l’assegnazione di particolari permessi. Nel caso del PACS, tipicamente viene
                utilizzata la porta 104. Per consentire il bind su questa porta è necessario eseguire, prima
                di avviare Orthanc DICOM Server, il seguente comando:<br><br>
                 <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>sudo setcap CAP_NET_BIND_SERVICE=+eip /usr/sbin/Orthanc</span>

                IMPORTANTE<br><br>

                Configurare correttamente la directory dove vengono archiviate le immagini DICOM. Il
                parametro nel file di configurazione di Orthanc DICOM Server, come descritto nel
                manuale di installazione e configurazione di WePacs, è StorageDirectory. Il valore da
                impostare, così come configurato in Installazione del Sistema Operativo, è /var/wepacs.
                Nella configurazione del plugin “postgresql” impostare la proprietà “EnableStorage” a
                “false”<br><br>

                IMPORTANTE<br><br>

                La directory <strong>/var/wepacs</strong> è accessibile, in scrittura, al solo utente root. Per fare in modo
                che sia il solo utente “orthanc” ad accedere in scrittura eseguire il seguente comando:<br><br>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>sudo chown -R orthanc:orthanc /var/wepacs</span>

                La directory dove sono presenti le librerie a collegamento dinamico dei plugin è <strong>/usr/lib/orthanc </strong><br><br>
                Si ricorda che Orthanc DICOM Server viene installano con tutti i plugin necessari. Quindi nel file di
                configurazione dello stesso è possibile lasciare la seguente configurazione per attivarli tutti:<br>
                <span class="command-highlight">"Plugins" : [<br>"/usr/share/orthanc/plugins/" <br>],</span>

                Tuttavia la configurazione dei plugin da preferire è quella che prevede solo i plugin realmente utilizzati:<br>
                 <span class="command-highlight">"Plugins" : [<br>"/usr/share/orthanc/plugins/libOrthancPostgreSQLStorage.so",<br>"/usr/share/orthanc/plugins/libOrthancPostgreSQLIndex.so",<br>"/usr/share/orthanc/plugins/libOrthancDicomWeb.so"<br>]</span>
                <br><br>
                <strong><i class="fas fa-arrow-right animated-arrow"></i>NOTA</strong><br><br>

                <strong>Per la configurazione di Orthanc DICOM Server, compresa la configurazione del plugin<br><br>
                database, si rimanda al manuale di installazione e configurazione di WePacs</strong></p>
            <div class="nav-buttons">
                <button onclick="goToStep(1)">Indietro</button>
                <button onclick="goToStep(3)">Avanti</button>
            </div>
        </div>
    </div>

    <div class="accordion">
        <div class="accordion-header">4️⃣ Installazione wepacs<i class="fas fa-chevron-right"></i></div>
        <div class="panel">
            <p>Installazione ed esecuzione di WePacs <br><br>
                Per eseguire WePacs è necessario decomprimere nella cartella /home/webinar il pacchetto della versione:
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>cd /home/webinar<br>mkdir wepacs</span>
                <p>Per decomprimere le versioni di WePacs è necessario il programma UNZIP. Se non presente eseguire il
                    seguente comando per installarlo:</p>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>sudo apt-get install unzip</span>
                <p>Copiare quindi il file wepacs_x.y.w.z.zip nella cartella appena creata (/home/webinar/wepacs), quindi eseguire
                    i comandi:</p>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>cd /home/webinar/wepacs<br>unzip wepacs-x.y.z.w.zip</span>
                <p>dove x.y.z.w rappresentano lo specifico numero di versione (ad esempio wepacs-1.2.0.0.zip)</p>
                <p>A questo punto eseguire:</p>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>sh ./add-executable-permission.sh</span>
                <p>Prima di eseguire WePacs procedere con la configurazione del file application.properties.</p>
                <p>È importante prestare attenzione alla configurazione dei parametri necessari all’utilizzo del database
                    PostgreSQL da parte WePacs, ossia:<br><br>
                    <span class="command-highlight">hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect<br>spring.datasource.driver-class-name=org.postgresql.Driver<br>spring.datasource.url=jdbc:postgresql://localhost:5432/wepacs<br>spring.datasource.username=postgres<br>spring.datasource.password=[PASSWORD]</span>
                    dove [PASSWORD] va sostituita con la password scelta in Installazione di PostgreSQL.
                    Solo il primo avvio impostare il parametro “spring.jpa.hibernate.ddl-auto” uguale a “create”:<br><br>
                    <span class="command-highlight">spring.jpa.hibernate.ddl-auto=create</span>
                    Per eseguire WePacs digitare:</p>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>./wepacs.sh</span>
                <p>Dopo il primo avvio impostare il parametro “spring.jpa.hibernate.ddl-auto” uguale a
                    “validate” altrimenti il database viene ricreato al successivo riavvio dell’applicazione</p>
                    <p>Anche WePacs deve essere installato come servizio. Per fare ciò è disponibile il comando service-creator
                        presente nel pacchetto di installazione. Per aggiungere il servizio eseguire il seguente comando:</p>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>sudo ./service-creator wepacs /home/webinar/wepacs/wepacs.sh</span>
                <p>come risultato dell’esecuzione del comando viene stampato lo stato del servizio appena installato, ad
                    esempio:<br><br>
                    <span class="command-highlight">2022-11-18 14:52:47 [INFO] Service name: wepacs<br>2022-11-18 14:52:47 [INFO] Executable file path: /home/webinar/wepacs/wepacs.sh<br>2022-11-18 14:52:47 [INFO] Copy wepacs.service to /etc/systemd/system/wepacs.service<br>2022-11-18 14:52:47 [INFO] systemctl daemon-reload<br>Created symlink /etc/systemd/system/multi-user.target.wants/wepacs.service →<br>/etc/systemd/system/wepacs.service.<br>● wepacs.service - "wepacs (Created by Protector4J)"<br>Loaded: loaded (/etc/systemd/system/wepacs.service; enabled; vendor preset: enabled)<br>Active: active (running) since Sun 2022-11-20 14:52:47 UTC; 370ms ago<br>Main PID: 6509 (wepacs.sh)<br>Tasks: 39 (limit: 37945)<br>Memory: 22.1M<br>CPU: 425ms</span>

                </p>
            <div class="nav-buttons">
                <button onclick="goToStep(2)">Indietro</button>
                <button onclick="goToStep(4)">Avanti</button>
            </div>
        </div>
    </div>


    <div class="accordion">
        <div class="accordion-header">5️⃣
            Installazione di MongoDB<i class="fas fa-chevron-right"></i></div>
        <div class="panel">
            <p>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>installare l'ultima versione (8.0.5) di mongodb community edition, disponibile sia per Windows che per Linux: <a href="https://www.mongodb.com/try/download/community" target="_blank" style="color: #a5d6a7;">https://www.mongodb.com/try/download/community</a></span><br><br>


                Linux
                scaricare il pacchetto per la versione compatibile con il s.o del server (per controllare utilizzare cat /etc/os-release)
                caricare il pacchetto (ad esempio in /home/webinar) ed eseguire il comando:<br><br>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>cd /home/webinar<br>dpkg -i pacchettomongodb.deb</span>

                una volta installato, verificare che il servizio sia stato creato con:<br>
                <span class="command-highlight">service mongod status</span>
                nel caso in cui sia stoppato, avviarlo con<br><br>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>service mongod start</span>

                Abilita l'avvio automatico di MongoDB all'avvio del sistema<br><br>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>sudo systemctl enable mongod</span>


                Impostiamo l’utente mongodb alla socket di collegamento Unix (necessario altrimenti al riavvio del servizio quest’ultimo non si avvierà)<br><br>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>sudo chown -R mongodb:mongodb /tmp/mongodb-27017.sock</span>


                dopodiché, dobbiamo installare mongo-sh per poter interagire con il database.<br><br>

                Aggiugiamo il repository ufficiale di MongoDB<br><br>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>curl -fsSL https://pgp.mongodb.com/server-6.0.asc | sudo gpg -o /usr/share/keyrings/mongodb-server-6.0.gpg --dearmor</span>

                crea il file del repository<br><br>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>echo "deb [ arch=amd64,arm64 signed-by=/usr/share/keyrings/mongodb-server-6.0.gpg ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/6.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-6.0.list</span>

                aggiorniamo il repository<br><br>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>sudo apt update</span>

                installiamo mongo-sh<br><br>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>sudo apt-get install mongodb-mongosh</span>

                entrare nel database tramite il comando:<br><br>
                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>mongosh</span>

                creiamo l’utente root eseguendo i seguenti comandI:<br><br>

                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>use wepacs #per creare il database</span>


                <span class="command-highlight">db.createUser({<br>  user: "root",<br>  pwd: passwordPrompt(),<br>  roles: [<br>    { role: "userAdminAnyDatabase", db: "admin" },<br>    { role: "readWrite", db: "admin" },<br>    { role: "readWrite", db: "wepacs" }<br>  ],<br>  mechanisms: ["SCRAM-SHA-1"]<br>})</span>




                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>riavvia mongodb, dopodiché. verifichiamo l’avvenuta creazione, provando ad entrare nel db con:</span>
                <span class="command-highlight">mongosh "mongodb://root:Abcdefg1%21@localhost:27017/wepacs"</span>


                <span class="command-highlight"><i class="fas fa-arrow-right animated-arrow"></i>Impostiamo l'autenticazione su mongodb<br>nano /etc/mongod.conf<br>incollare:<br>security:<br>  authorization: enabled<br><br>riavvia mongodb: Service mongod restart </span>
                <br><br>


                </p>
            <div class="nav-buttons">
                <button onclick="goToStep(3)">Indietro</button>
                <button disabled>Fine</button>
            </div>
        </div>
    </div>
</div>

<script>
    const accordions = document.querySelectorAll('.accordion');
    const headers = document.querySelectorAll('.accordion-header');
    const panels = document.querySelectorAll('.panel');
    const progressBar = document.getElementById('progress-bar');
    const stepCounter = document.getElementById('step-counter');
    const totalSteps = accordions.length;

    headers.forEach((header, index) => {
        header.addEventListener('click', function() {
            const isActive = accordions[index].classList.contains('active');
            closeAll();
            if (!isActive) {
                openStep(index);
            }
        });
    });

    function closeAll() {
        accordions.forEach(acc => acc.classList.remove('active'));
        panels.forEach(panel => panel.style.maxHeight = null);
    }

    function openStep(index) {
        accordions.forEach((acc, i) => {
            if (i === index) {
                acc.classList.add('active');
                requestAnimationFrame(() => {
                    panels[i].style.maxHeight = panels[i].scrollHeight + "px";
                });
            } else {
                acc.classList.remove('active');
                panels[i].style.maxHeight = null;
            }
        });
        accordions[index].scrollIntoView({ behavior: 'smooth', block: 'center' });
        updateProgress(index);
        updateNavButtons(index);
    }

    function goToStep(index) {
        if (index >= 0 && index < totalSteps) {
            openStep(index);
        }
    }

    function updateProgress(index) {
        const percent = ((index + 1) / totalSteps) * 100;
        progressBar.style.width = percent + '%';
        stepCounter.textContent = `Passo ${index + 1} di ${totalSteps}`;
    }

    function updateNavButtons(index) {
        const currentAccordion = accordions[index];
        const buttons = currentAccordion.querySelectorAll('.nav-buttons button');
        const prevButton = buttons[0];
        const nextButton = buttons[1];

        if (index === 0) {
            prevButton.disabled = true;
        } else {
            prevButton.disabled = false;
        }

        if (index === totalSteps - 1) {
            nextButton.disabled = true;
        } else {
            nextButton.disabled = false;
        }
    }

    // Apri il primo step all'avvio e aggiorna i pulsanti
    openStep(0);
</script>

</body>
</html>
